// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["referentialActions", "nApi", "interactiveTransactions"]
}

generator nestgraphql {
  provider = "node node_modules/prisma-nestjs-graphql"
  output   = "../src/@generated/prisma-nestjs-graphql"
  reExport = Directories

  fields_Validator_from  = "class-validator"
  fields_Validator_input = true
}

enum ElectionType {
  shared
  virtual
}

model Election {
  /// @HideField({ output: false, input: true })
  id            Int          @id @default(autoincrement())
  /// @HideField({ output: false, input: true })
  code          String       @unique
  /// @HideField({ output: false, input: true })
  numbeOfJoined Int          @default(0) @map("numbe_of_joined")
  /// @HideField({ output: false, input: true })
  voterCount    Int          @default(0) @map("voter_count")
  /// @HideField({ output: false, input: true })
  lastUsed      DateTime     @default(now()) @map("last_used")
  /// @HideField({ output: false, input: true })
  type          ElectionType @default(shared)
  /// @Validator.IsNotEmpty()
  data          Json

  photo   Photo?
  /// @HideField({ output: true, input: true })
  photoId Int?

  @@map("elections")
}

model Photo {
  id   Int    @id @default(autoincrement())
  data String

  election Election @relation(fields: [electionId], references: [id], onDelete: Cascade)

  electionId Int

  @@map("photos")
}
